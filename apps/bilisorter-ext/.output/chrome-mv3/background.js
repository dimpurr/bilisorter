(function(){"use strict";function H(r){return typeof r=="function"?{main:r}:r}const O="https://api.bilibili.com",q="https://api.anthropic.com",C={SETTINGS:"bilisorter_settings",FOLDERS:"bilisorter_folders",VIDEOS:"bilisorter_videos",SUGGESTIONS:"bilisorter_suggestions",OPERATION_LOG:"bilisorter_operation_log"},$={NAV:"/x/web-interface/nav",FOLDER_LIST:"/x/v3/fav/folder/created/list-all",VIDEO_LIST:"/x/v3/fav/resource/list",MOVE:"/x/v3/fav/resource/move"},W={MESSAGES:"/v1/messages"},j={MIN_BATCH_SIZE:5,MAX_BATCH_SIZE:10,INTER_BATCH_DELAY_MS:300,MAX_RETRIES:1,RATE_LIMIT_PAUSE_MS:3e4};async function D(){try{const[r,l,a]=await Promise.all([chrome.cookies.get({url:"https://www.bilibili.com",name:"SESSDATA"}),chrome.cookies.get({url:"https://www.bilibili.com",name:"bili_jct"}),chrome.cookies.get({url:"https://www.bilibili.com",name:"DedeUserID"})]);return r!=null&&r.value?{SESSDATA:r.value,bili_jct:(l==null?void 0:l.value)||"",DedeUserID:(a==null?void 0:a.value)||""}:(console.log("[BiliAPI] SESSDATA not found, user not logged in"),null)}catch(r){return console.error("[BiliAPI] Error extracting cookies:",r),null}}function B(r){const l=[`SESSDATA=${r.SESSDATA}`];return r.bili_jct&&l.push(`bili_jct=${r.bili_jct}`),r.DedeUserID&&l.push(`DedeUserID=${r.DedeUserID}`),l.join("; ")}async function G(r){try{const l=B(r),i=await(await fetch(`${O}${$.NAV}`,{headers:{Cookie:l}})).json();if(i.code!==0||!i.data)return console.log("[BiliAPI] Nav API error:",i),{loggedIn:!1};const e=r.DedeUserID||String(i.data.mid);return{loggedIn:i.data.isLogin,uid:e,username:i.data.uname}}catch(l){return console.error("[BiliAPI] Error checking auth:",l),{loggedIn:!1}}}async function K(r,l){try{const a=B(l),e=await(await fetch(`${O}${$.FOLDER_LIST}?up_mid=${r}`,{headers:{Cookie:a}})).json();if(e.code!==0||!e.data)throw new Error(`Failed to fetch folders: ${e.code}`);return e.data.list.map(o=>({id:o.id,name:o.title,media_count:o.media_count,sampleTitles:[]}))}catch(a){throw console.error("[BiliAPI] Error fetching folders:",a),a}}async function Z(r,l,a){if(l===0)return[];try{const i=B(a),e=Math.ceil(l/20),o=Math.max(1,Math.ceil(Math.random()*e)),n=await(await fetch(`${O}${$.VIDEO_LIST}?media_id=${r}&pn=${o}&ps=20`,{headers:{Cookie:i}})).json();return n.code!==0||!n.data||!n.data.medias?[]:n.data.medias.slice(0,10).map(m=>m.title)}catch(i){return console.error("[BiliAPI] Error fetching folder sample:",i),[]}}async function X(r,l,a){const i=[];let e=1,o=!0,c=0;const n=B(l);for(;o;)try{const f=await(await fetch(`${O}${$.VIDEO_LIST}?media_id=${r}&pn=${e}&ps=20`,{headers:{Cookie:n}})).json();if(f.code!==0||!f.data)throw new Error(`Failed to fetch videos: ${f.code}`);const{medias:p,has_more:u,total:b}=f.data;b!==void 0&&(c=b);for(const x of p||[])i.push({bvid:x.bvid,title:x.title,cover:x.cover,upper:x.upper,cnt_info:x.cnt_info,fav_time:new Date(x.fav_time*1e3).toISOString(),intro:x.intro,tags:[],attr:x.attr});a==null||a(i.length,c),o=u,e++}catch(m){throw console.error("[BiliAPI] Error fetching videos:",m),m}return i}async function z(r,l,a,i){try{const e=B(i),o=new URLSearchParams;o.append("media_id",r.toString()),o.append("target_media_id",l.toString()),o.append("resources",`${a}:2`),o.append("csrf",i.bili_jct);const n=await(await fetch(`${O}${$.MOVE}`,{method:"POST",headers:{Cookie:e,"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json();return n.code===72010002?{success:!0}:n.code!==0?{success:!1,error:n.message||`Error code: ${n.code}`,code:n.code}:{success:!0}}catch(e){return console.error("[BiliAPI] Error moving video:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}async function J(r,l,a,i,e,o){const c=r.filter(u=>u.attr===0),n=l.filter(u=>u.id!==a);if(n.length===0)throw new Error("没有目标收藏夹");if(c.length===0)throw new Error("没有有效视频");const m={},f=j.MAX_BATCH_SIZE,p=Math.ceil(c.length/f);for(let u=0;u<p;u++){const b=c.slice(u*f,(u+1)*f);try{const x=await Y(b,n,i,e);for(const[_,k]of Object.entries(x))m[_]=k;o==null||o(u+1,p),u<p-1&&await new Promise(_=>setTimeout(_,j.INTER_BATCH_DELAY_MS))}catch(x){console.error(`[ClaudeAPI] Batch ${u+1} failed:`,x)}}return m}async function Y(r,l,a,i){const e=Q(r,l),o=await ee(e,a,i);return re(o)}function Q(r,l){const a=l.map(e=>`- ${e.name} (ID: ${e.id}, ${e.media_count}个视频)${e.sampleTitles.length>0?`
  示例: `+e.sampleTitles.slice(0,5).join(", "):""}`).join(`
`),i=r.map(e=>{var c;const o=((c=e.tags)==null?void 0:c.length)>0?` [标签: ${e.tags.join(", ")}]`:"";return`- BVID: ${e.bvid}
  标题: ${e.title}
  UP主: ${e.upper.name}${o}`}).join(`
`);return`你是一个视频分类助手。请将以下视频分类到最合适的收藏夹中。

## 可用收藏夹

${a}

## 待分类视频

${i}

## 输出格式

请返回JSON格式：
{
  "classifications": [
    {
      "bvid": "视频BVID",
      "suggestions": [
        {"folder_id": 收藏夹ID, "folder_name": "收藏夹名称", "confidence": 0.95},
        ...
      ]
    }
  ]
}

每个视频最多返回5个建议，按置信度从高到低排序。置信度范围0-1，建议阈值：≥0.8高置信度，0.5-0.8中等，<0.5低置信度。`}async function ee(r,l,a){var c,n;const i={model:a,max_tokens:4096,messages:[{role:"user",content:r}],system:"你是一个视频分类助手。请根据视频标题、UP主、标签等信息，将视频分类到最合适的收藏夹。只返回JSON格式，不要添加任何解释性文字。"},e=await fetch(`${q}${W.MESSAGES}`,{method:"POST",headers:{"Content-Type":"application/json","X-API-Key":l,"Anthropic-Version":"2023-06-01"},body:JSON.stringify(i)});if(!e.ok){const m=await e.json().catch(()=>({}));throw new Error(`Claude API error: ${e.status} - ${((c=m.error)==null?void 0:c.message)||e.statusText}`)}return((n=(await e.json()).content[0])==null?void 0:n.text)||""}function re(r,l){try{const a=r.match(/\{[\s\S]*\}/);if(!a)throw new Error("No JSON found in response");const i=JSON.parse(a[0]);if(!i.classifications||!Array.isArray(i.classifications))throw new Error("Invalid response format");const e={};for(const o of i.classifications){const{bvid:c,suggestions:n}=o;!c||!Array.isArray(n)||(e[c]=n.filter(m=>m.folder_id&&m.folder_name).slice(0,5).map(m=>({folderId:m.folder_id,folderName:m.folder_name,confidence:Math.max(0,Math.min(1,m.confidence||0))})))}return e}catch(a){return console.error("[ClaudeAPI] Failed to parse response:",a),{}}}const se=H(()=>{console.log("[BiliSorter] Background service worker started");const r=new Map;chrome.runtime.onMessage.addListener((e,o,c)=>{if(e.type==="CHECK_AUTH")return l().then(c).catch(n=>{console.error("[BiliSorter] CHECK_AUTH error:",n),c({loggedIn:!1})}),!0;if(e.type==="GET_COOKIES")return D().then(c).catch(()=>c(null)),!0;if(e.type==="MOVE_VIDEO"){const{srcFolderId:n,dstFolderId:m,resourceId:f,resourceType:p}=e;return D().then(u=>{if(!u)throw new Error("未登录");return z(n,m,f,u)}).then(c).catch(u=>c({success:!1,error:u.message})),!0}return!1}),chrome.runtime.onConnect.addListener(e=>{console.log("[BiliSorter] Port connected:",e.name),r.set(e.name,e),e.onMessage.addListener(o=>{o.type==="INDEX"?a(e):o.type==="GET_SUGGESTIONS"&&i(e,o.videos,o.folders)}),e.onDisconnect.addListener(()=>{console.log("[BiliSorter] Port disconnected:",e.name),r.delete(e.name)})});async function l(){const e=await D();if(!e)return console.log("[BiliSorter] No valid cookies found"),{loggedIn:!1};const o=await G(e);return console.log("[BiliSorter] Auth check result:",o),o}async function a(e){var o,c;console.log("[BiliSorter] Starting index operation");try{const n=await D();if(!n){e.postMessage({type:"ERROR",error:"未登录"});return}const m=await G(n);if(!m.loggedIn||!m.uid){e.postMessage({type:"ERROR",error:"登录已过期"});return}const f=m.uid;console.log("[BiliSorter] Fetching folders for uid:",f);const p=await K(f,n);console.log("[BiliSorter] Fetched",p.length,"folders");for(let E=0;E<p.length;E++){const y=p[E];if(y.media_count>0)try{const M=await Z(y.id,y.media_count,n);y.sampleTitles=M}catch(M){console.warn("[BiliSorter] Failed to sample folder",y.id,M),y.sampleTitles=[]}e.postMessage({type:"FOLDERS_READY",folders:p.slice(0,E+1)}),await new Promise(M=>setTimeout(M,10))}const b=((o=(await chrome.storage.local.get(C.SETTINGS))[C.SETTINGS])==null?void 0:o.sourceFolderId)||((c=p[0])==null?void 0:c.id);if(!b){e.postMessage({type:"ERROR",error:"没有找到收藏夹"});return}console.log("[BiliSorter] Fetching videos from folder:",b);let x=0;const _=await X(b,n,(E,y)=>{x=E,e.postMessage({type:"FETCH_PROGRESS",loaded:E,total:y})});console.log("[BiliSorter] Fetched",_.length,"videos");const k=Date.now();e.postMessage({type:"INDEX_COMPLETE",videos:_,sourceFolderId:b,timestamp:k}),await chrome.storage.local.set({[C.FOLDERS]:p,[C.VIDEOS]:_,bilisorter_lastIndexed:k}),console.log("[BiliSorter] Index operation complete")}catch(n){console.error("[BiliSorter] Index operation failed:",n),e.postMessage({type:"ERROR",error:n instanceof Error?n.message:"未知错误"})}}async function i(e,o,c){var n;console.log("[BiliSorter] Starting suggestion generation");try{const f=(await chrome.storage.local.get(C.SETTINGS))[C.SETTINGS];if(!(f!=null&&f.apiKey)){e.postMessage({type:"ERROR",error:"未配置 API Key"});return}const p=(n=c[0])==null?void 0:n.id,u=await J(o,c,p,f.apiKey,f.model||"claude-3-5-haiku-latest",(b,x)=>{e.postMessage({type:"SUGGESTION_PROGRESS",completed:b,total:x})});await chrome.storage.local.set({[C.SUGGESTIONS]:u}),e.postMessage({type:"SUGGESTIONS_COMPLETE",suggestions:u}),console.log("[BiliSorter] Suggestion generation complete")}catch(m){console.error("[BiliSorter] Suggestion generation failed:",m),e.postMessage({type:"ERROR",error:m instanceof Error?m.message:"未知错误"})}}});var te=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ne={exports:{}};(function(r,l){(function(a,i){i(r)})(typeof globalThis<"u"?globalThis:typeof self<"u"?self:te,function(a){var i,e;if(!((e=(i=globalThis.chrome)==null?void 0:i.runtime)!=null&&e.id))throw new Error("This script should only be loaded in a browser extension.");if(typeof globalThis.browser>"u"||Object.getPrototypeOf(globalThis.browser)!==Object.prototype){const o="The message port closed before a response was received.",c=n=>{const m={alarms:{clear:{minArgs:0,maxArgs:1},clearAll:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getAll:{minArgs:0,maxArgs:0}},bookmarks:{create:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},getChildren:{minArgs:1,maxArgs:1},getRecent:{minArgs:1,maxArgs:1},getSubTree:{minArgs:1,maxArgs:1},getTree:{minArgs:0,maxArgs:0},move:{minArgs:2,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeTree:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}},browserAction:{disable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},enable:{minArgs:0,maxArgs:1,fallbackToNoCallback:!0},getBadgeBackgroundColor:{minArgs:1,maxArgs:1},getBadgeText:{minArgs:1,maxArgs:1},getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},openPopup:{minArgs:0,maxArgs:0},setBadgeBackgroundColor:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setBadgeText:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},browsingData:{remove:{minArgs:2,maxArgs:2},removeCache:{minArgs:1,maxArgs:1},removeCookies:{minArgs:1,maxArgs:1},removeDownloads:{minArgs:1,maxArgs:1},removeFormData:{minArgs:1,maxArgs:1},removeHistory:{minArgs:1,maxArgs:1},removeLocalStorage:{minArgs:1,maxArgs:1},removePasswords:{minArgs:1,maxArgs:1},removePluginData:{minArgs:1,maxArgs:1},settings:{minArgs:0,maxArgs:0}},commands:{getAll:{minArgs:0,maxArgs:0}},contextMenus:{remove:{minArgs:1,maxArgs:1},removeAll:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},cookies:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:1,maxArgs:1},getAllCookieStores:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},devtools:{inspectedWindow:{eval:{minArgs:1,maxArgs:2,singleCallbackArg:!1}},panels:{create:{minArgs:3,maxArgs:3,singleCallbackArg:!0},elements:{createSidebarPane:{minArgs:1,maxArgs:1}}}},downloads:{cancel:{minArgs:1,maxArgs:1},download:{minArgs:1,maxArgs:1},erase:{minArgs:1,maxArgs:1},getFileIcon:{minArgs:1,maxArgs:2},open:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},pause:{minArgs:1,maxArgs:1},removeFile:{minArgs:1,maxArgs:1},resume:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},extension:{isAllowedFileSchemeAccess:{minArgs:0,maxArgs:0},isAllowedIncognitoAccess:{minArgs:0,maxArgs:0}},history:{addUrl:{minArgs:1,maxArgs:1},deleteAll:{minArgs:0,maxArgs:0},deleteRange:{minArgs:1,maxArgs:1},deleteUrl:{minArgs:1,maxArgs:1},getVisits:{minArgs:1,maxArgs:1},search:{minArgs:1,maxArgs:1}},i18n:{detectLanguage:{minArgs:1,maxArgs:1},getAcceptLanguages:{minArgs:0,maxArgs:0}},identity:{launchWebAuthFlow:{minArgs:1,maxArgs:1}},idle:{queryState:{minArgs:1,maxArgs:1}},management:{get:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},getSelf:{minArgs:0,maxArgs:0},setEnabled:{minArgs:2,maxArgs:2},uninstallSelf:{minArgs:0,maxArgs:1}},notifications:{clear:{minArgs:1,maxArgs:1},create:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:0},getPermissionLevel:{minArgs:0,maxArgs:0},update:{minArgs:2,maxArgs:2}},pageAction:{getPopup:{minArgs:1,maxArgs:1},getTitle:{minArgs:1,maxArgs:1},hide:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setIcon:{minArgs:1,maxArgs:1},setPopup:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},setTitle:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0},show:{minArgs:1,maxArgs:1,fallbackToNoCallback:!0}},permissions:{contains:{minArgs:1,maxArgs:1},getAll:{minArgs:0,maxArgs:0},remove:{minArgs:1,maxArgs:1},request:{minArgs:1,maxArgs:1}},runtime:{getBackgroundPage:{minArgs:0,maxArgs:0},getPlatformInfo:{minArgs:0,maxArgs:0},openOptionsPage:{minArgs:0,maxArgs:0},requestUpdateCheck:{minArgs:0,maxArgs:0},sendMessage:{minArgs:1,maxArgs:3},sendNativeMessage:{minArgs:2,maxArgs:2},setUninstallURL:{minArgs:1,maxArgs:1}},sessions:{getDevices:{minArgs:0,maxArgs:1},getRecentlyClosed:{minArgs:0,maxArgs:1},restore:{minArgs:0,maxArgs:1}},storage:{local:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}},managed:{get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1}},sync:{clear:{minArgs:0,maxArgs:0},get:{minArgs:0,maxArgs:1},getBytesInUse:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}}},tabs:{captureVisibleTab:{minArgs:0,maxArgs:2},create:{minArgs:1,maxArgs:1},detectLanguage:{minArgs:0,maxArgs:1},discard:{minArgs:0,maxArgs:1},duplicate:{minArgs:1,maxArgs:1},executeScript:{minArgs:1,maxArgs:2},get:{minArgs:1,maxArgs:1},getCurrent:{minArgs:0,maxArgs:0},getZoom:{minArgs:0,maxArgs:1},getZoomSettings:{minArgs:0,maxArgs:1},goBack:{minArgs:0,maxArgs:1},goForward:{minArgs:0,maxArgs:1},highlight:{minArgs:1,maxArgs:1},insertCSS:{minArgs:1,maxArgs:2},move:{minArgs:2,maxArgs:2},query:{minArgs:1,maxArgs:1},reload:{minArgs:0,maxArgs:2},remove:{minArgs:1,maxArgs:1},removeCSS:{minArgs:1,maxArgs:2},sendMessage:{minArgs:2,maxArgs:3},setZoom:{minArgs:1,maxArgs:2},setZoomSettings:{minArgs:1,maxArgs:2},update:{minArgs:1,maxArgs:2}},topSites:{get:{minArgs:0,maxArgs:0}},webNavigation:{getAllFrames:{minArgs:1,maxArgs:1},getFrame:{minArgs:1,maxArgs:1}},webRequest:{handlerBehaviorChanged:{minArgs:0,maxArgs:0}},windows:{create:{minArgs:0,maxArgs:1},get:{minArgs:1,maxArgs:2},getAll:{minArgs:0,maxArgs:1},getCurrent:{minArgs:0,maxArgs:1},getLastFocused:{minArgs:0,maxArgs:1},remove:{minArgs:1,maxArgs:1},update:{minArgs:2,maxArgs:2}}};if(Object.keys(m).length===0)throw new Error("api-metadata.json has not been included in browser-polyfill");class f extends WeakMap{constructor(t,A=void 0){super(A),this.createItem=t}get(t){return this.has(t)||this.set(t,this.createItem(t)),super.get(t)}}const p=s=>s&&typeof s=="object"&&typeof s.then=="function",u=(s,t)=>(...A)=>{n.runtime.lastError?s.reject(new Error(n.runtime.lastError.message)):t.singleCallbackArg||A.length<=1&&t.singleCallbackArg!==!1?s.resolve(A[0]):s.resolve(A)},b=s=>s==1?"argument":"arguments",x=(s,t)=>function(d,...S){if(S.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${b(t.minArgs)} for ${s}(), got ${S.length}`);if(S.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${b(t.maxArgs)} for ${s}(), got ${S.length}`);return new Promise((w,T)=>{if(t.fallbackToNoCallback)try{d[s](...S,u({resolve:w,reject:T},t))}catch(g){console.warn(`${s} API method doesn't seem to support the callback parameter, falling back to call it without a callback: `,g),d[s](...S),t.fallbackToNoCallback=!1,t.noCallback=!0,w()}else t.noCallback?(d[s](...S),w()):d[s](...S,u({resolve:w,reject:T},t))})},_=(s,t,A)=>new Proxy(t,{apply(d,S,w){return A.call(S,s,...w)}});let k=Function.call.bind(Object.prototype.hasOwnProperty);const E=(s,t={},A={})=>{let d=Object.create(null),S={has(T,g){return g in s||g in d},get(T,g,I){if(g in d)return d[g];if(!(g in s))return;let h=s[g];if(typeof h=="function")if(typeof t[g]=="function")h=_(s,s[g],t[g]);else if(k(A,g)){let P=x(g,A[g]);h=_(s,s[g],P)}else h=h.bind(s);else if(typeof h=="object"&&h!==null&&(k(t,g)||k(A,g)))h=E(h,t[g],A[g]);else if(k(A,"*"))h=E(h,t[g],A["*"]);else return Object.defineProperty(d,g,{configurable:!0,enumerable:!0,get(){return s[g]},set(P){s[g]=P}}),h;return d[g]=h,h},set(T,g,I,h){return g in d?d[g]=I:s[g]=I,!0},defineProperty(T,g,I){return Reflect.defineProperty(d,g,I)},deleteProperty(T,g){return Reflect.deleteProperty(d,g)}},w=Object.create(s);return new Proxy(w,S)},y=s=>({addListener(t,A,...d){t.addListener(s.get(A),...d)},hasListener(t,A){return t.hasListener(s.get(A))},removeListener(t,A){t.removeListener(s.get(A))}}),M=new f(s=>typeof s!="function"?s:function(A){const d=E(A,{},{getContent:{minArgs:0,maxArgs:0}});s(d)}),U=new f(s=>typeof s!="function"?s:function(A,d,S){let w=!1,T,g=new Promise(R=>{T=function(v){w=!0,R(v)}}),I;try{I=s(A,d,T)}catch(R){I=Promise.reject(R)}const h=I!==!0&&p(I);if(I!==!0&&!h&&!w)return!1;const P=R=>{R.then(v=>{S(v)},v=>{let F;v&&(v instanceof Error||typeof v.message=="string")?F=v.message:F="An unexpected error occurred",S({__mozWebExtensionPolyfillReject__:!0,message:F})}).catch(v=>{console.error("Failed to send onMessage rejected reply",v)})};return P(h?I:g),!0}),ie=({reject:s,resolve:t},A)=>{n.runtime.lastError?n.runtime.lastError.message===o?t():s(new Error(n.runtime.lastError.message)):A&&A.__mozWebExtensionPolyfillReject__?s(new Error(A.message)):t(A)},V=(s,t,A,...d)=>{if(d.length<t.minArgs)throw new Error(`Expected at least ${t.minArgs} ${b(t.minArgs)} for ${s}(), got ${d.length}`);if(d.length>t.maxArgs)throw new Error(`Expected at most ${t.maxArgs} ${b(t.maxArgs)} for ${s}(), got ${d.length}`);return new Promise((S,w)=>{const T=ie.bind(null,{resolve:S,reject:w});d.push(T),A.sendMessage(...d)})},ae={devtools:{network:{onRequestFinished:y(M)}},runtime:{onMessage:y(U),onMessageExternal:y(U),sendMessage:V.bind(null,"sendMessage",{minArgs:1,maxArgs:3})},tabs:{sendMessage:V.bind(null,"sendMessage",{minArgs:2,maxArgs:3})}},L={clear:{minArgs:1,maxArgs:1},get:{minArgs:1,maxArgs:1},set:{minArgs:1,maxArgs:1}};return m.privacy={network:{"*":L},services:{"*":L},websites:{"*":L}},E(n,ae,m)};a.exports=c(chrome)}else a.exports=globalThis.browser})})(ne);function N(r,...l){}var oe={debug:(...r)=>N(console.debug,...r),log:(...r)=>N(console.log,...r),warn:(...r)=>N(console.warn,...r),error:(...r)=>N(console.error,...r)};try{se.main()instanceof Promise&&console.warn("The background's main() function return a promise, but it must be synchronous")}catch(r){throw oe.error("The background crashed on startup!"),r}})();
